@page "/admin/clients/{id:int}/edit"
@model IdentityServerAspNetIdentity.Pages.Admin.Clients.EditModel
@{
	ViewData["Title"] = "Edit Client";
}

<div class="container mt-4">


	<div class="row">
		<div class="col-md-12">
			<h2><i class="fas fa-edit"></i> Edit Client</h2>

			@if (TempData["Success"] != null)
			{
				<div class="alert alert-success alert-dismissible fade show" role="alert">
					@TempData["Success"]
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>
			}

			<div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

			<form method="post">


				

				<ck-tabs>
					<ck-tab label="Basic Information" active>
						<div class="form-group">
							<label asp-for="Input.ClientId" class="form-label"></label>
							<input asp-for="Input.ClientId" class="form-control" />
							<span asp-validation-for="Input.ClientId" class="text-danger"></span>
						</div>

						<div class="form-group">
							<label asp-for="Input.ClientName" class="form-label"></label>
							<input asp-for="Input.ClientName" class="form-control" />
							<span asp-validation-for="Input.ClientName" class="text-danger"></span>
						</div>

						<div class="form-group">
							<label asp-for="Input.Description" class="form-label"></label>
							<textarea asp-for="Input.Description" class="form-control" rows="3"></textarea>
							<span asp-validation-for="Input.Description" class="text-danger"></span>
						</div>

						<div class="form-group">
							<label asp-for="Input.ClientUri" class="form-label"></label>
							<input asp-for="Input.ClientUri" class="form-control" />
							<span asp-validation-for="Input.ClientUri" class="text-danger"></span>
						</div>

						<div class="form-group">
							<label asp-for="Input.LogoUri" class="form-label"></label>
							<input asp-for="Input.LogoUri" class="form-control" />
							<span asp-validation-for="Input.LogoUri" class="text-danger"></span>
						</div>

						<div class="form-group">
							<label asp-for="Input.Enabled" class="form-label"></label>
							<div class="form-switch">
								<input asp-for="Input.Enabled" class="form-check-input form-switch-input" />
								<span class="form-slider" aria-hidden="true"></span>
							</div>
						</div>
					</ck-tab>

					<ck-tab label="Authentication & Secrets">
						<div class="form-group">
							<label asp-for="Input.RequirePkce" class="form-label"></label>
							<div class="form-switch">
								<input asp-for="Input.RequirePkce" class="form-check-input form-switch-input" />
								<span class="form-slider" aria-hidden="true"></span>
							</div>
						</div>

						<div class="form-group">
							<label asp-for="Input.RequireClientSecret" class="form-label"></label>
							<div class="form-switch">
								<input asp-for="Input.RequireClientSecret" class="form-check-input form-switch-input" />
								<span class="form-slider" aria-hidden="true"></span>
							</div>
						</div>

						<div class="form-group">
							<label asp-for="Input.RequireConsent" class="form-label"></label>
							<div class="form-switch">
								<input asp-for="Input.RequireConsent" class="form-check-input form-switch-input" />
								<span class="form-slider" aria-hidden="true"></span>
							</div>
						</div>

						<div class="form-group">
							<label asp-for="Input.AllowOfflineAccess" class="form-label"></label>
							<div class="form-switch">
								<input asp-for="Input.AllowOfflineAccess" class="form-check-input form-switch-input" />
								<span class="form-slider" aria-hidden="true"></span>
							</div>
						</div>

						<div class="form-group">
							<label asp-for="Input.AlwaysIncludeUserClaimsInIdToken" class="form-label"></label>
							<div class="form-switch">
								<input asp-for="Input.AlwaysIncludeUserClaimsInIdToken" class="form-check-input form-switch-input" />
								<span class="form-slider" aria-hidden="true"></span>
							</div>
						</div>

						<div class="form-group">
							<label asp-for="Input.NewSecret" class="form-label"></label>
							<input asp-for="Input.NewSecret" class="form-control" />
							<span asp-validation-for="Input.NewSecret" class="text-danger"></span>
							<div class="form-text">Leave empty to keep existing secrets unchanged.</div>
						</div>

						<div class="form-group">
							<label asp-for="Input.NewSecretDescription" class="form-label"></label>
							<input asp-for="Input.NewSecretDescription" class="form-control" />
							<span asp-validation-for="Input.NewSecretDescription" class="text-danger"></span>
						</div>
					</ck-tab>

					<!-- STORY-1: New dedicated tab for Allowed Grant Types -->
					<ck-tab label="Allowed Grant Types">
						<multiselect-checkbox
							title="Select Authorization Flows"
							description="Choose which OAuth2/OIDC authorization flows this client is allowed to use."
							multiselect-for="Input.AllowedGrantTypes"
							multiselect-items="Input.AvailableGrantTypes"
							fieldset-id="grant-types-fieldset"
							id-prefix="grant-type-checkbox"
							empty-message="No grant types available. Contact your administrator." />
					</ck-tab>

					<!-- STORY-2: Refactored Scopes tab with consistent multiselect pattern -->
					<ck-tab label="Scopes">
						<multiselect-checkbox
							title="Select Resource Scopes"
							description="Choose which resource scopes this client is allowed to request."
							multiselect-for="Input.AllowedScopes"
							multiselect-items="Input.AvailableScopes"
							fieldset-id="scopes-fieldset"
							id-prefix="scope-checkbox"
							empty-message="No scopes available. Contact your administrator." />
					</ck-tab>

					<ck-tab label="URIs">
						<div class="form-group">
							

							<label class="form-label">Redirect URIs</label>
							<ck-edit-array
								id="redirectUrisEditor"
								array-field="Input.RedirectUris"
								item-direction="row"
								add-label="Add new RedirectURI"
								primitive-array
								data-initial-json="@System.Text.Json.JsonSerializer.Serialize(Model.Input.RedirectUris.Select(u => new { value = u }))">
								<div slot="display">
									<code data-display-for="value"></code>
								</div>
								<div slot="edit">
									<input name="value" class="form-control" type="url" placeholder="https://example.com/callback" />
								</div>
								@* <div slot="buttons"> *@
								@* 	<button type="button" data-action="add"><i class="fas fa-plus"></i> Add Redirect URI</button> *@
								@* </div> *@
							</ck-edit-array>
						</div>

						<div class="form-group">
						<label class="form-label">Post Logout Redirect URIs</label>
						<ck-edit-array
							id="postLogoutRedirectUrisEditor"
							array-field="Input.PostLogoutRedirectUris"
							item-direction="row"
							add-label="Add new Post Logout Redirect URI"
							primitive-array
							data-initial-json="@System.Text.Json.JsonSerializer.Serialize(Model.Input.PostLogoutRedirectUris.Select(u => new { value = u }))">
							<div slot="display">
								<code data-display-for="value"></code>
							</div>
							<div slot="edit">
								<input name="value" class="form-control" type="url" placeholder="https://example.com/logout" />
							</div>
						</ck-edit-array>
					</div>

						<div class="form-group">
							<label asp-for="Input.FrontChannelLogoutUri" class="form-label"></label>
							<input asp-for="Input.FrontChannelLogoutUri" class="form-control" />
							<span asp-validation-for="Input.FrontChannelLogoutUri" class="text-danger"></span>
						</div>

						<div class="form-group">
							<label asp-for="Input.BackChannelLogoutUri" class="form-label"></label>
							<input asp-for="Input.BackChannelLogoutUri" class="form-control" />
							<span asp-validation-for="Input.BackChannelLogoutUri" class="text-danger"></span>
						</div>
					</ck-tab>

					<ck-tab label="Tokens">
						<div class="form-group">
							<label asp-for="Input.AccessTokenLifetime" class="form-label"></label>
							<input asp-for="Input.AccessTokenLifetime" class="form-control" type="number" />
							<span asp-validation-for="Input.AccessTokenLifetime" class="text-danger"></span>
						</div>

						<div class="form-group">
							<label asp-for="Input.IdentityTokenLifetime" class="form-label"></label>
							<input asp-for="Input.IdentityTokenLifetime" class="form-control" type="number" />
							<span asp-validation-for="Input.IdentityTokenLifetime" class="text-danger"></span>
						</div>

						<div class="form-group">
							<label asp-for="Input.SlidingRefreshTokenLifetime" class="form-label"></label>
							<input asp-for="Input.SlidingRefreshTokenLifetime" class="form-control" type="number" />
							<span asp-validation-for="Input.SlidingRefreshTokenLifetime" class="text-danger"></span>
						</div>
					</ck-tab>
				</ck-tabs>

				<!-- Action Buttons -->
				<div class="d-flex justify-content-between mt-4">
					<a href="/" class="button button-secondary">
						<i class="fas fa-arrow-left"></i> Back to Home
					</a>
					<button type="submit" class="button button-primary">
						<i class="fas fa-save"></i> Save Changes
					</button>
				</div>
			</form>
		</div>
	</div>
</div>

@section scripts {
	<partial name="_ValidationScriptsPartial" />
	<script src="~/js/clients-edit.js"></script>
}
